# Ensure the data directory exists
if not os.path.exists(DATA_DIRECTORY):
    os.makedirs(DATA_DIRECTORY)


@app.route('/upload', methods=['POST'])
def upload_file():
    if 'file' not in request.files:
        return jsonify({"error": "No file part"}), 400

    file = request.files['file']
    if file.filename == '':
        return jsonify({"error": "No selected file"}), 400

    try:
        # Ensure the device directory exists
        device = request.form.get('device')
        device_path = os.path.join(DATA_DIRECTORY, device)
        if not os.path.exists(device_path):
            os.makedirs(device_path)

        # Save the file to the device folder
        file_path = os.path.join(device_path, file.filename)
        file.save(file_path)

        # Return success message
        return jsonify({"message": f"File '{file.filename}' uploaded successfully to {device}."}), 200
    except Exception as e:
        return jsonify({"error": str(e)}), 500
